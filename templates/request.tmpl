// This code is auto-generated by curly
package main

import (
    {{range $val := .imports}}
        "{{$val}}"
    {{end}}
)

func main() {
    var wg sync.WaitGroup

    numReqs := {{.opts.NumReqs}}
    concurrentReqs := {{.opts.ConcurrentReqs}}
    sleepDuration, _ := time.ParseDuration("{{.opts.SleepDuration}}")

    chunks := numReqs / concurrentReqs

    for c := 0; c < chunks; c++ {
        for r := 0; r < concurrentReqs; r++ {
            wg.Add(1)

            go func() {
                defer wg.Done()
                request()
            }()
        }
    	wg.Wait()

    	time.Sleep(sleepDuration)
    }
}

func request() {
{{ .code }}

respBody, err := ioutil.ReadAll(resp.Body)

if err != nil {
    fmt.Println(err)
    return
}

fmt.Println(string(respBody))
}